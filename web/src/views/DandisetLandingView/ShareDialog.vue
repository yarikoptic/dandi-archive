<template>
  <v-dialog
    v-if="meta && meta.name"
    v-model="dialog"
    offset-y
    min-width="420"
    max-width="500"
  >
    <template #activator="{ on }">
      <div
        class="d-inline"
        v-on="on"
      >
        <v-icon
          color="primary"
          style="cursor: pointer;"
        >
          mdi-share-variant
        </v-icon>
        {{ text }}
      </div>
    </template>

    <v-card>
      <v-card-title>
        <v-btn
          icon
          x-small
          :right="true"
          :absolute="true"
          @click="dialog = false"
        >
          <v-icon>mdi-close</v-icon>
        </v-btn>
      </v-card-title>
      <v-card-title class="text-h6">
        {{ meta.name }}
      </v-card-title>
      <v-card-text>
        <span class="font-weight-black">
          Share this dandiset with this link:
        </span>
        <CopyText
          class="pa-2"
          :text="permalink"
          icon-hover-text="Copy permalink to clipboard"
        />
      </v-card-text>
      <v-divider class="mx-4" />
      <v-card-actions>
        <v-list-item class="grow">
          <v-row
            align="center"
          >
            <ShareNetwork
              network="twitter"
              :url="permalink"
              :title="meta.name"
              :twitter-user="twitterUser"
            >
              <v-icon
                class="mr-1"
                color="blue"
                large
              >
                mdi-twitter
              </v-icon>
            </ShareNetwork>
          </v-row>
        </v-list-item>
      </v-card-actions>
    </v-card>
  </v-dialog>
</template>

<script setup lang="ts">
import { computed, ref } from 'vue';

import CopyText from '@/components/CopyText.vue';
import { useDandisetStore } from '@/stores/dandiset';
import { dandiUrl } from '@/utils/constants';

defineProps({
  text: {
    type: String,
    default: '',
  },
});

// Twitter user to mention
const twitterUser = 'DANDIarchive';

const store = useDandisetStore();

const currentDandiset = computed(() => store.dandiset);
const currentVersion = computed(() => store.version);
const meta = computed(() => currentDandiset.value?.metadata);
const permalink = computed(() => {
  if (currentDandiset.value?.dandiset && currentVersion.value) {
    return `${dandiUrl}/dandiset/${currentDandiset.value?.dandiset.identifier}/${currentVersion.value}`;
  }
  return '';
});

const dialog = ref(false);

</script>
